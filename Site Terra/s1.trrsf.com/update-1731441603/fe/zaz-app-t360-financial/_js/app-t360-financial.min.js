/*! zaz-app-t360-financial - v1.0.0 - 14/10/2024 -- 6:27pm */

zaz.use(function(pkg){"use strict";var dicFactory;pkg.factoryManager.get("dict").create({name:"t360.financial",version:"1.0.0",state:"ok",extends:[],langs:{en:{},es:{},pt:{more:"veja mais",applications:"Aplicações",exchange:"Câmbio",stockexchange:"Bolsa e Câmbio",commodities:"Commodities",cryptocurrencies:"Criptomoedas",inflation:"Inflação",index:"Índice",currency:"Moeda",product:"Produto",date:"Data",value:"Valor",variation:"Variação",price:"Preço",time:"Hora","dollar commercial":"Dólar Comercial","dollar tourism":"Dólar Turismo","dollar comm":"Dólar Com","dollar tour":"Dólar Tur",euro:"Euro",pound:"Libra",petroleum:"Petróleo",gold:"Ouro",silver:"Prata",platinum:"Platina",purchase:"Compra",sell:"Venda"}}})}),zaz.use(function(pkg){"use strict";var dicFactory;pkg.factoryManager.get("dict").create({name:"t360.financial",version:"1.0.0",state:"ok",extends:[],langs:{en:{},es:{},pt:{more:"veja mais",applications:"Aplicações",exchange:"Câmbio",stockexchange:"Bolsa e Câmbio",commodities:"Commodities",cryptocurrencies:"Criptomoedas",inflation:"Inflação",index:"Índice",currency:"Moeda",product:"Produto",date:"Data",value:"Valor",variation:"Variação",price:"Preço",time:"Hora","dollar commercial":"Dólar Comercial","dollar tourism":"Dólar Turismo","dollar comm":"Dólar Com","dollar tour":"Dólar Tur",euro:"Euro",pound:"Libra",petroleum:"Petróleo",gold:"Ouro",silver:"Prata",platinum:"Platina",purchase:"Compra",sell:"Venda"}}})}),zaz.use(function appFinancial(pkg){"use strict";var console=pkg.console,appFactory=pkg.factoryManager.get("app"),STATIC_PUBLIC=null,STATIC_PRIVATE={mods:{}};appFactory.create({name:"t360.financial",version:"2.0.0",state:"ok",docs:"http://github.tpn.terra.com/pages/terra/financial",source:"http://github.tpn.terra.com/Terra/financial",description:"Financial indicators",tests:"http://s1.trrsf.com/fe/financial/tests/index.htm?zaz[env]=tests",dependencies:[],dictionaries:["t360.financial"],templates:{card:'<div class="app-financial--card"><h2 class="app-financial--header header--{{type}}"><a target="_top" href="{{url}}" class="text">{{ dict.get(type) }}</a><div class="app-financial--header--wrapper"><a href="https://www.vivomoney.com.br/?utm_source=terra" target="_blank" class="app-financial--bt-vivopay"><span class="app-financial--icon-vivopay"></span></a><button target="_top" class="refresh"><div class="item-icon icon-solid icon-16 icon-sync-alt iconfix"></div><div class="item-icon icon-solid icon-16 icon-sync-alt loading"></div></button></div></h2><div class="content"><ul class="list list--{{type}}">{% if type == "applications" %}<li class="list__row list__row--header"><span class="list__text small-padding title"></span><span class="list__text small-padding value nospace">{{ dict.get(\'value\') }}</span><span class="list__text small-padding date">{{ dict.get(\'date\') }}</span></li>{% for row in feed %}<li class="list__row" id="listup"><span class="list__text name">{{ row.name }}</span><span id="loadtext" class="list__text variation {{ row.status }} nospace">{{ row.value }}</span><span id="loadtext" class="list__text value">{{ row.date }}</span></li>{% endfor %}{% elif type == "commodities" %}<li class="list__row list__row--header"><span class="list__text small-padding title"></span><span class="list__text small-padding variation nospace">{{ dict.get(\'variation\') }}</span><span class="list__text small-padding price">{{ dict.get(\'price\') }}</span></li>{% for row in feed %}<li class="list__row"><span class="list__text product">{{ row.name }}</span><span id="loadtext" class="list__text variation {{ row.status }} nospace">{{ row.variation }}</span><span id="loadtext" class="list__text price">{{ row.price }}</span></li>{% endfor %}{% elif type == "cryptocurrencies" %}<li class="list__row list__row--header"><span class="list__text small-padding title"></span><span class="list__text small-padding variation nospace">{{ dict.get(\'variation\') }}</span><span class="list__text small-padding value">{{ dict.get(\'value\') }}</span></li>{% for row in feed %}<li class="list__row"><span class="list__text currency{% if row.icon %} icon icon-{{ row.icon }}{% endif %}">{{ row.name }}</span><span id="loadtext" class="list__text variation {{ row.status }} nospace">{{ row.variation }}</span><span id="loadtext" class="list__text value">{{ row.value }}</span></li>{% endfor %}{% elif type == "exchange" %}<li class="list__row list__row--header"><span class="list__text small-padding title"></span><span class="list__text small-padding variation nospace">{{ dict.get(\'variation\') }}</span><span class="list__text small-padding purchase">{{ dict.get(\'purchase\') }}</span></li>{% for row in feed %}<li class="list__row"><span class="list__text name {% if row.icon %}icon icon-{{ row.icon }}{% endif %}">{{ row.name }}</span><span id="loadtext" class="list__text variation {{ row.status }} nospace">{{ row.variation }}</span><span id="loadtext" class="list__text purchase">{{ row.purchase }}</span></li>{% endfor %}{% elif type == "stockexchange" %}<li class="list__row list__row--header"><span class="list__text small-padding title"></span><span class="list__text small-padding variation nospace">{{ dict.get(\'variation\') }}</span><span class="list__text small-padding purchase">{{ dict.get(\'purchase\') }}</span></li>{% for row in feed %}<li class="list__row{% if row.collapse %} collapse{% endif %} {{row.icon if row.icon else \'\'}}"><span class="list__text name {% if row.icon %}icon icon-{{ row.icon }}{% endif %}">{{ row.name }}</span><span id="loadtext" class="list__text variation {{ row.status }} nospace">{{ row.variation }}</span><span id="loadtext" class="list__text purchase">{{ row.purchase }}</span></li>{% endfor %}{% elif type == "inflation" %}<li class="list__row list__row--header"><span class="list__text small-padding title"></span><span class="list__text small-padding variation nospace">{{ dict.get(\'value\') }}</span><span class="list__text small-padding value">{{ dict.get(\'date\') }}</span></li>{% for row in feed %}<li class="list__row"><span class="list__text currency">{{ row.name }}</span><span id="loadtext" class="list__text variation {{ row.status }} nospace">{{ row.value }}</span><span id="loadtext" class="list__text value">{{ row.date }}</span></li>{% endfor %}{% endif %}</ul></div></div>'},expects:{type:"object",properties:{container:{type:"object"},data:{type:"object",properties:{configs:{type:"object",properties:{theme:{type:"string"},subtype:{type:"string"}}}}}},required:["container","data"]},setup:function(STATIC_PUBLIC,PUBLIC,__shared){pkg.utils.merge(STATIC_PRIVATE.mods,__shared.dependencies.mod),STATIC_PRIVATE.indicatorTypes={applications:{indicators:{AESLIC:{name:"SELIC"},AETR:{name:"TR"},AECDI:{name:"CDI"}},canonizeItem:function canonizeItem(cItem){var indicators=STATIC_PRIVATE.indicatorTypes.applications.indicators,value=Number(cItem.ult),cItem={cod:cItem.cod,name:indicators[cItem.cod].name,date:(cItem.hor||cItem.var).replace(":","h"),value:value.toFixed(2).replace(".",",")+"%"};return cItem.status=0<value?"positive":value<0?"negative":"equal",cItem}},exchange:{indicators:{"BRL-AE":{name:PUBLIC.l10n.get("dollar commercial"),icon:"dollar"},AEUSTR:{name:PUBLIC.l10n.get("dollar tourism"),icon:"dollar"},AEEUCO:{name:PUBLIC.l10n.get("euro"),icon:"euro"},AEGBB1:{name:PUBLIC.l10n.get("pound"),icon:"pound"}},canonizeItem:function canonizeItem(cItem){var indicators=STATIC_PRIVATE.indicatorTypes.exchange.indicators,variation=Number(cItem.var),cItem={cod:cItem.cod,name:indicators[cItem.cod].name,icon:indicators[cItem.cod].icon,purchase:"R$ "+Number(cItem.ocp).toFixed(3).replace(".",","),sell:Number(cItem.ult).toFixed(3).replace(".",","),value:Number(cItem.ult).toFixed(3).replace(".",",")};return isNaN(variation)?(cItem.purchase="--",cItem.variation="--",cItem.status="closed"):0<variation?(cItem.status="positive",cItem.variation="+"+variation.toFixed(2).replace(".",",")+"%"):(cItem.status=variation<0?"negative":"equal",cItem.variation=variation.toFixed(2).replace(".",",")+"%"),cItem}},stockexchange:{indicators:{"BRL-AE":{name:PUBLIC.l10n.get("dollar commercial"),icon:"dollar"},AEUSTR:{name:PUBLIC.l10n.get("dollar tourism"),icon:"dollar",collapse:!0},AEEUCO:{name:PUBLIC.l10n.get("euro"),icon:"euro"},AEGBB1:{name:PUBLIC.l10n.get("pound"),icon:"pound",collapse:!0},IBOV:{name:"Ibovespa",icon:"bovespa",format:function(item,cItem){return cItem.purchase="--",cItem.sell="--",cItem}},"BTC-MERCBIT":{name:"Bitcoin",icon:"bitcoin",format:function(item,cItem){return 1e3<=item.abe?cItem.purchase="R$ "+Number(item.abe).toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1."):cItem.purchase="R$ "+Number(item.abe).toFixed(2).replace(".",","),cItem}}},canonizeItem:function canonizeItem(item){var indicators=STATIC_PRIVATE.indicatorTypes.stockexchange.indicators,variation=Number(item.var),cItem={cod:item.cod,name:indicators[item.cod].name,icon:indicators[item.cod].icon,purchase:"R$ "+Number(item.ocp).toFixed(3).replace(".",","),sell:Number(item.ult).toFixed(3).replace(".",","),value:Number(item.ult).toFixed(3).replace(".",","),collapse:indicators[item.cod].collapse};return isNaN(variation)?(cItem.purchase="--",cItem.variation="--",cItem.status="closed"):0<variation?(cItem.status="positive",cItem.variation="+"+variation.toFixed(2).replace(".",",")+"%"):(cItem.status=variation<0?"negative":"equal",cItem.variation=variation.toFixed(2).replace(".",",")+"%"),"function"==typeof indicators[item.cod].format?indicators[item.cod].format(item,cItem):(cItem.second="R$ "+cItem.second,cItem)}},commodities:{indicators:{WTI:{name:PUBLIC.l10n.get("petroleum")+" (spot)"},GOLD:{name:PUBLIC.l10n.get("gold")+" (oz)"},SILVER:{name:PUBLIC.l10n.get("silver")+" (oz)"},PLAT:{name:PUBLIC.l10n.get("platinum")+" (oz)"}},canonizeItem:function canonizeItem(cItem){var indicators=STATIC_PRIVATE.indicatorTypes.commodities.indicators,variation=Number(cItem.var),cItem={cod:cItem.cod,name:indicators[cItem.cod].name,price:"U$ "+Number(cItem.ult).toFixed(2).replace(".",","),time:cItem.hor.replace(":","h")};return 0<variation?(cItem.status="positive",cItem.variation="+"+variation.toFixed(2).replace(".",",")+"%"):variation<0?(cItem.status="negative",cItem.variation=variation.toFixed(2).replace(".",",")+"%"):(cItem.status="equal",cItem.variation=variation.toFixed(0)+"%"),cItem}},cryptocurrencies:{indicators:{"BTC-MERCBIT":{name:"Bitcoin",icon:"bitcoin",format:"R$",prop:"abe"},"LTC-MERCBIT":{name:"Litecoin",icon:"litecoin",format:"R$",prop:"ult"},"ETH-FLOW":{name:"Ethereum",icon:"ethereum",format:"R$",prop:"ult"}},canonizeItem:function canonizeItem(value){var variation=STATIC_PRIVATE.indicatorTypes.cryptocurrencies.indicators,cItem={cod:value.cod,name:variation[value.cod].name,icon:variation[value.cod].icon,format:variation[value.cod].format,prop:variation[value.cod].prop},variation=Number(value.var),value=Number(value[cItem.prop]);return cItem.value=1e3<=value?cItem.format+" "+value.toFixed(0).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1."):cItem.format+" "+value.toFixed(2).replace(".",","),isNaN(variation)?(cItem.variation="--",cItem.status="closed"):0<variation?(cItem.status="positive",cItem.variation="+"+variation.toFixed(2).replace(".",",")+"%"):(cItem.status=variation<0?"negative":"equal",cItem.variation=variation.toFixed(2).replace(".",",")+"%"),cItem}},inflation:{indicators:{AEIPCA:{name:"IPCA"},AEINPC:{name:"INPC"},AEIPCD:{name:"IPC"},AEIGPM:{name:"IGPM"}},canonizeItem:function canonizeItem(cItem){var indicators=STATIC_PRIVATE.indicatorTypes.inflation.indicators,value=Number(cItem.ult),cItem={cod:cItem.cod,name:indicators[cItem.cod].name,date:cItem.var,value:value.toFixed(2).replace(".",",")+"%"};return cItem.status=0<value?"positive":value<0?"negative":"equal",cItem}}}},init:function(data,__shared){var PRIVATE={},PUBLIC=this,PRIVATE;return(PRIVATE=data&&data.data&&data.data.configs?Object.create(data.data.configs):{}).container=data.container,PRIVATE.feedUrl="https://p1-cloud.trrsf.com.br/api/top-indices",PRIVATE.isBigCard=PRIVATE.container.classList.contains("card-app-v"),PRIVATE.theme||(PRIVATE.theme="card"),PRIVATE.subtype||(PRIVATE.subtype="applications"),PRIVATE.container.addClass("loading-app"),PRIVATE.getFeedData=function(){return STATIC_PRIVATE.feedDataPromise||(STATIC_PRIVATE.feedDataPromise=new Promise(function(resolve,reject){fetch(PRIVATE.feedUrl).then(function(response){if(response.ok)return response.json();throw new Error("could not fetch data")}).then(function(data){data&&data.ativos&&data.ativos.ativo&&0<data.ativos.ativo.length?(STATIC_PRIVATE.feedData=data,resolve(data)):reject("no data"),STATIC_PRIVATE.feedDataPromise=null}).catch(function(){reject("could not fetch data")})})),STATIC_PRIVATE.feedDataPromise},PRIVATE.canonizeFeed=function(data){var feed=[],indicatorType=STATIC_PRIVATE.indicatorTypes[PRIVATE.subtype],acceptIndicators=Object.keys(indicatorType.indicators),feed;return(feed=data.filter(function(item){return-1!==acceptIndicators.indexOf(item.cod)}).map(indicatorType.canonizeItem)).sort(function(a,b){var aIndex,bIndex;return acceptIndicators.indexOf(a.cod)-acceptIndicators.indexOf(b.cod)}),feed},PRIVATE.getDate=function(){for(var dateFormated,i=0;i<PRIVATE.data.length;i++){if("date"===PRIVATE.data[i].dateType){dateFormated="em "+PRIVATE.data[i].date;break}dateFormated="às "+PRIVATE.data[i].date}return dateFormated},PRIVATE.renderTemplate=function(){var html={feed:PRIVATE.data,url:"https://www.terra.com.br/economia",type:PRIVATE.subtype,dict:PUBLIC.l10n,theme:PRIVATE.theme},html=PUBLIC.templates.render(PRIVATE.theme,html);html&&(PRIVATE.container.removeClass("loading-app"),PRIVATE.container.addClass("app-financial"),PRIVATE.container.innerHTML="",PRIVATE.container.appendChild(html),PRIVATE.bind())},PRIVATE.getFeedData().then(function(data){PRIVATE.data=PRIVATE.canonizeFeed(data.ativos.ativo),PRIVATE.data&&0<PRIVATE.data.length&&PRIVATE.renderTemplate()}),PRIVATE.bind=function(){var btnRefresh=PRIVATE.container.querySelector(".refresh"),iconSpin=PRIVATE.container.querySelector(".loading"),iconFix=PRIVATE.container.querySelector(".iconfix"),loadText=PRIVATE.container.querySelectorAll("#loadtext");btnRefresh.addEventListener("click",function(){iconSpin.style.display="inline-block",iconFix.style.display="none",loadText.forEach(function(x){x.textContent="--"}),PRIVATE.getFeedData().then(function(data){PRIVATE.data=PRIVATE.canonizeFeed(data.ativos.ativo),PRIVATE.data&&0<PRIVATE.data.length&&setTimeout(function(){PRIVATE.renderTemplate()},1e3)})})},PUBLIC},teardown:function(why,__static,__proto,__shared){}})});